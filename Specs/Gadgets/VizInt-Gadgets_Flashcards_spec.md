# Flashcards Gadget Specification v1.0

> **Part of the VizInt Portal Ecosystem**
> **Conforms to VizInt Gadget API v1.0 (see: VizInt-Gadgets-1.2.md)**
> **Runs inside VizInt Portal v1.2 (see: VizInt-Portal-1.2.md)**

---

## $VER

Flashcards Gadget Specification v1.0

## $HISTORY

* **2025/03/02 ‚Äì v1.0 ‚Äì Initial specification generated based on Flashcards Gadget implementation learnings**

---

# 1. Overview

The Flashcards Gadget is an officially sanctioned VizInt Gadget that provides:

* CSV-driven flashcard decks
* Manual and automatic progression
* Sequential or deterministic-random (drand) rotation
* Optional inline-answer reveal
* Optional flip-to-answer mode
* Config overlay for editing CSV, mode, timing, and behaviour
* Local persistence through `ctx.getSettings()` and `ctx.setSettings()`

This document defines:

1. The functional requirements
2. The behavioural model
3. The data model saved in settings
4. Timer, rotation, and state rules
5. Mandatory UX conventions
6. Integration requirements with the Portal & Gadget API
7. A backlog epilogue

---

# 2. Manifest Structure

The gadget MUST export an object with:

```js
window.GADGETS.flashcards = {
    manifest: {

		_api: "1.0",
		_class: "flashcards",
		_type: "multi",
		_id: "default",
		_ver: "v0.4.0",
		verblurb:
			"Adding pin/bookmarking & üëéüëç to support learning",
		label: "Flash Cards",
		iconEmoji: "üéì",
		capabilities: ["network"], // URL fetch (paste works offline)
		description:
			"CSV-powered flash cards with sequential or diminishing-random rotation.",
		supportsSettings: true // üëà THIS is the important bit
		capabilities: ["network"],
		description: "CSV-powered flash cards with sequential or diminishing-random rotation."
    },
    mount(host, ctx) { ... }
};
```

* **Icon click** MUST open the config overlay (same as settings button inside the gadget).
* **Capabilities** remain empty for Flashcards v1.0.

---

# 3. Layout Requirements

The gadget MUST render:

* **Primary viewport** containing card front/back or inline mode.
* **Toolbar** containing buttons:

  * Previous
  * Flip / reveal
  * Next
  * Reset (üßπ)
  * Purge (üóëÔ∏è)
  * Mode toggle (seq/drand)
  * Auto toggle (‚ñ∂Ô∏è/‚è∏Ô∏è)
  * Interval cycle buttons
  * Settings (‚öôÔ∏è)

The config panel MUST:

* Pause timers automatically.
* Fill the *entire gadget viewport*, replacing the card area (NOT append below it).
* Include: Paste CSV, Source URL, Load-from-URL, Mode toggle, Auto toggle, Interval, Flip Style.

---

# 4. CSV Requirements

CSV MUST be interpreted as:

```
{Side A}, {Side B}, {Notes}
```

* Quotes optional but supported.
* UTF‚Äë8 required.
* Sanitization required (strip HTML, strip injection vectors).
* Auto-detect delimiter (comma, semicolon, tab, pipe). Default comma.
* Parser MUST support multi-line entries.

Notes MUST be appended to Side B with a visual separator.

Example:

```
"Ciao", "Hello", "Greeting"
```

---

# 5. Data Model in Settings

Saved under `settings.flashcards`:

```js
{
    rawCSV: "string or empty",
    sourceUrl: "",
    parsed: [
        { a: "Ciao", b: "Hello", notes: "Greeting" },
        ...
    ],
    mode: "sequential" | "drand",
    auto: true | false,
    intervalMs: 5000,
    flipStyle: "reveal" | "inline",
    ui: {
        showConfig: false
    }
}
```

### Rules:

* `parsed` MUST be regenerated by the Save button.
* `rawCSV` MUST persist independently of `parsed`.
* On mount: If `rawCSV` exists but `parsed` is empty, the gadget MUST automatically regenerate `parsed` without writing settings.

---

# 6. Rotation Model

## 6.1 Sequential Mode

* `index` increases by +1 modulo deck size.
* Previous/Next MUST not mutate `parsed`.
* History MUST track visited positions for back navigation.

## 6.2 Deterministic Random (drand) Mode

* `cycleOrder` is a full-deck permutation.
* First card MUST NOT always be element 0.
* After exhausting a permutation, a new permutation MUST be generated.
* Only sequential user navigation modifies cyclePos.

---

# 7. Timers & Auto-Progress

* Gadget MUST use a single-shot timer, NOT setInterval.
* Any manual action (next, previous, flip) MUST reset the timer.
* Opening config MUST stop the timer.
* Closing config MUST restart it only if auto==true.

---

# 8. UI/UX Rules

* Side A MUST scale to largest possible size using viewport-aware CSS.
* Side B may be smaller but must remain highly legible.
* Inline-answer mode MUST put answer in smaller font beneath main word.
* Toolbar buttons MUST not cause page reload.
* Fineprint MUST show format: `[#6~18/105]`.
* Auto timer MUST show `auto {x}/5s` countdown.

---

# 9. LocalStorage / Settings Safety

The Flashcards gadget MUST obey the following:

1. MUST NOT call `ctx.setSettings()` during mount().
2. MUST debounce all settings writes.
3. MUST always merge settings at subtree level.
4. MUST isolate all state under key `flashcards`.
5. MUST provide a commented-out hard-abort switch inside mount() for disaster recovery.

---

# 10. Security

* All user input sanitized.
* No inline script injection allowed.
* No scriptable HTML tags allowed inside cards.
* External URL loads MUST respect CORS.

---

# 11. Integration Requirements

Flashcards is:

* A VizInt Gadget ‚Üí MUST follow `mount(host, ctx)` lifecycle.
* Hosted in the VizInt Portal ‚Üí MUST support theme switching, responsive layout, and portal-driven state persistence.
* MUST NOT override Portal CSS; only use namespaced classes.

---

# 12. Epilogue: Backlog

* Replace config panel with full-viewport modal.
* Add spaced repetition engine (v2.0).
* Add thumbs-up/thumbs-down memory scoring.
* Add long-term spaced review buckets.
* Add smart deck statistics.
* Add CSV export.
* Add deck import presets.
* Add global keyboard shortcuts.

---

<!--
INCREMENTAL EDIT v0.?.? ‚Äî Flashcards Spec Update
Changes below are additive and diff-friendly.
-->

## Toolbar Model (Updated)

### Visibility & Interaction

* **Desktop**: Toolbars appear on hover over the gadget chrome.
* **Touch UI**: Toolbars appear on tap anywhere on gadget chrome and auto-hide after *N* seconds.
* Implementation **reuses the hidden-toolbar model** employed by the *Embed-Web* gadget (details to be shared later).

### Top Toolbar (Primary Actions)

**Left-aligned:**

* üëç / üëé (future spaced repetition signals)
* ‚ô• / ‚ù§Ô∏è ‚Äî View mode toggle:

  * ‚ô• Regular view (show all cards)
  * ‚ù§Ô∏è Favorites-only view
* üîñ Bookmark (mark/unmark card as favorite)
* üìå Pin (pin card permanently above rotating deck)
* üìã Share (clipboard-first payload)

**Right-aligned:**

* üßπ Sweep (deck reset; relocated from main UI into toolbar only)

### Bottom Toolbar (Playback & Display)

**Left-aligned:**

* ‚èÆÔ∏è / ‚è≠Ô∏è Previous / Next
* üîÅ Mode toggle (Sequential / Diminishing Random)
* ‚ñ∂Ô∏è Play / Pause (Auto)
* üîÑ Flip / Reveal

**Right-aligned:**

* üÜé Display mode toggle:

  * Side A only
  * Side B only
  * A | B together

---

## Card Identity & Persistence

### Card Hash (Internal Identity)

* Card identity hash is computed **only from Side A + Side B**.
* Notes / hint fields are **explicitly excluded**.
* No CSV-level hashing is performed.

### Share Identity

Shared payload MUST include:

* Card hash (A + B)
* Source URL (if present)
* Gadget instance label
* Timestamp

---

## Favorites & Pins

* üîñ Bookmark toggles *favorite* status per card (per instance).
* ‚ô•/‚ù§Ô∏è Favorites view filters deck to favorites only.
* üìå Pin keeps the card permanently rendered **above** the rotating card.
* All pin/favorite state is **per gadget instance**, persisted via `ctx.settings`.

---

## Layout & Typography

* **Grow-to-fill** layout is the default for:

  * Side A
  * Side B
  * A | B combined view
* Text dynamically scales to available viewport space.
* Hint / notes remain in fineprint style for now.

### Settings (Per Instance)

* Font size controls (min/max bounds)
* Toggle grow-to-fill on/off
* All settings are **per instance**, no global state.

---

## Future-Looking: Spaced Repetition (Deferred)

* üëç / üëé signals reserved for spaced repetition logic.
* Behavior to be defined in a dedicated *Spaced Repetition Spec*.
* Chronus integration explicitly **on hold**.

---

## Spec Governance Notes

* This document is part of the **VizInt Portal** ecosystem.
* Flashcards is a **VizInt Gadget**, compliant with Gadget Spec v1.2.x.
* All changes follow:

  * Incremental edits
  * Non-nuking doctrine
  * Human-diffable updates

**END OF SPEC**
